// generate_logs.cpp
#include <bits/stdc++.h>
#include <filesystem>
using namespace std;
namespace fs = std::filesystem;

int main() {
    const int num_files = 3000;
    const int lines_per_file = 20000;
    const string out_dir = "logs";

    // ngày bắt đầu (dd_mm_yy)
    int start_dd = 1, start_mm = 1, start_yy = 25; // 01_01_25
    // Tạo thư mục
    fs::create_directories(out_dir);

    std::random_device rd;
    std::mt19937_64 rng(rd());
    std::uniform_int_distribution<int> eventDist(1, 1000000); // để điều chỉnh tỉ lệ chèn
    std::uniform_int_distribution<int> randNum(1, 1000);

    for (int i = 0; i < num_files; ++i) {
        // tính ngày (simple: cộng ngày, không xử lý tháng qua năm chính xác cho mục đích bài tập)
        // Tuy nhiên để tên file không trùng nhau ta vẫn có thể dùng i để tạo dd_mm_yy chu kỳ.
        int day = (start_dd + i) % 28 + 1;    // cho chắc không vượt ngày trong tháng (1..28)
        int month = (start_mm + (i / 28)) % 12;
        if (month == 0) month = 12;
        int year = start_yy + ((start_mm + (i / 28) - 1) / 12);

        char fname[64];
        snprintf(fname, sizeof(fname), "log_%02d_%02d_%02d.txt", day, month, year % 100);
        string filepath = (fs::path(out_dir) / fname).string();

        ofstream ofs(filepath, ios::out);
        if (!ofs) {
            cerr << "Không thể tạo file: " << filepath << "\n";
            return 1;
        }

        for (int line = 1; line <= lines_per_file; ++line) {
            // Tạo timestamp đơn giản (có thể là thời điểm hiện tại hoặc giả lập)
            // Mình sẽ dùng chrono để in thời gian hiện tại + offset
            auto now = std::chrono::system_clock::now() + std::chrono::seconds(i * lines_per_file + line);
            std::time_t t = std::chrono::system_clock::to_time_t(now);
            char timestr[64];
            std::strftime(timestr, sizeof(timestr), "%Y-%m-%d %H:%M:%S", std::localtime(&t));

            // Xác suất chèn keyword: ta sử dụng eventDist RNG (ví dụ 1 trên 2000)
            if (eventDist(rng) <= 25) { // ~25/1e6 -> 0.0025% (rất hiếm). chỉnh nếu muốn nhiều hơn.
                ofs << timestr << " - User action: login by 99\n";
            } else {
                ofs << timestr << " - Random event " << randNum(rng) << " occurred.\n";
            }
        }
        ofs.close();

        if ((i+1) % 100 == 0) {
            cout << "Đã tạo " << (i+1) << " / " << num_files << " files\n";
        }
    }

    cout << "Hoàn tất: đã tạo " << num_files << " file trong thư mục '" << out_dir << "'\n";
    return 0;
}
